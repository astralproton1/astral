<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astral</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="overrides.css">
    <link rel="icon" href="logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700;800&display=swap" rel="stylesheet">
    <style>
    /* Iframe overlay + sidebar (minimal, tweak in style.css later if desired) */
    #game-iframe-overlay{position:fixed;inset:0;background:rgba(4,6,12,0.85);backdrop-filter:blur(6px);z-index:99998;display:flex;align-items:center;justify-content:center;padding:18px}
    #game-iframe-overlay.hidden{display:none}
    .iframe-container{position:relative;width:100%;height:100%;max-width:1400px;max-height:92vh;background:#000;border-radius:12px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,0.75)}
    #game-iframe{width:100%;height:100%;border:0;background:#000}
    .iframe-exit{position:absolute;left:14px;top:14px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;z-index:5}
    .iframe-toggle-arrow{position:fixed;right:18px;top:50%;transform:translateY(-50%);width:44px;height:44px;background:linear-gradient(180deg,#0f1724,#071025);border-radius:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:100000;border:2px solid rgba(255,255,255,0.06);box-shadow:0 6px 18px rgba(0,0,0,0.6)}
    .iframe-toggle-arrow span{display:inline-block;color:#cfeaff;font-weight:800;transform:rotate(0deg);transition:transform .25s}
    .iframe-toggle-arrow.open span{transform:rotate(180deg)}
    .iframe-sidebar{position:fixed;right:0;top:0;height:100vh;width:320px;background:linear-gradient(180deg,#0f1220,#071025);box-shadow:-12px 0 40px rgba(0,0,0,0.7);transform:translateX(100%);transition:transform .28s ease;z-index:100001;padding:18px;display:flex;flex-direction:column;gap:14px}
    .iframe-sidebar.open{transform:translateX(0)}
    .sidebar-close{align-self:flex-end;background:none;border:none;color:#fff;font-size:22px;cursor:pointer}
    .sidebar-content{margin-top:6px}
    .sidebar-content .background-button{width:100%;padding:12px 14px;border-radius:10px;cursor:pointer}
    @media (max-width:840px){.iframe-container{max-width:100%;max-height:100%;border-radius:0}.iframe-toggle-arrow{right:10px}}
    /* Settings modal styles */
    .settings-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,12,0.75);z-index:100000;}
    .settings-modal.hidden{display:none}
    .settings-card{width:92%;max-width:760px;background:linear-gradient(180deg,#0f1724,#071025);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(0,0,0,0.7);color:#e7f7ff}
    .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .settings-row{display:flex;flex-direction:column;gap:6px}
    .settings-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
    .settings-card h3{margin:0 0 6px 0}
    @media(max-width:720px){.settings-grid{grid-template-columns:1fr}}

    /* === PANTALLA DE INSTRUCCIONES (rediseño Paint) === */
    .game-instructions{position:fixed;inset:0;z-index:100003;background:#000;opacity:0;visibility:hidden;transition:opacity 340ms ease,visibility 340ms ease}
    .game-instructions.show{opacity:1;visibility:visible}
    .game-instructions.hidden{display:none}

    .instructions-card{width:100%;height:100%;background:#000;color:#fff;display:flex;flex-direction:column;border-top:4px solid #fff;border-bottom:4px solid #fff;overflow:hidden}

    /* HEADER */
    .instructions-top{display:flex;align-items:center;gap:18px;padding:16px 24px;border-bottom:4px solid #fff;background:#000}
    .instr-logo{width:72px;height:72px;object-fit:contain;border-radius:12px;background:#000000;flex-shrink:0}
    .instr-title-wrap{flex:1;text-align:center}
    .instr-timer{font-family:Oswald,Arial,sans-serif;font-size:1.1rem;color:#fff;margin-bottom:4px}
    .instr-game-title{font-family:Oswald,Arial,sans-serif;font-size:clamp(32px,8vw,80px);font-weight:800;margin:0;line-height:1}

    /* BODY: 2 columnas */
    .instructions-body{flex:1;display:flex;border-bottom:4px solid #fff;overflow:hidden}
    .instr-left{flex:1;padding:20px 24px;display:flex;flex-direction:column;border-right:4px solid #fff;overflow-y:auto}
    .instr-right{width:45%;min-width:300px;display:flex;align-items:center;justify-content:center;padding:12px;background:#000}

    .instr-section-title{font-family:Oswald,Arial,sans-serif;font-size:1.3rem;font-weight:700;margin:0 0 12px 0;color:#fff;text-decoration:underline}
    .instr-text{color:#fff;font-size:1.1rem;line-height:1.5}

    /* VIDEO */
    .instr-video-wrap{width:100%;height:100%;display:flex;align-items:center;justify-content:center}
    .instr-video-container{position:relative;width:100%;height:100%;background:#000;border-radius:8px;overflow:hidden}
    .instr-video{width:100%;height:100%;object-fit:cover}
    .instr-video-placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.2rem;text-align:center;padding:20px}
    #instr-overlay-play{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.6);border:none;color:#fff;padding:16px;border-radius:50%;font-size:1.4rem;display:none;cursor:pointer}

    /* FOOTER */
    .instructions-bottom{padding:16px 24px;background:#000;display:flex;flex-direction:column;gap:12px}
    .instr-bottom-content{flex:1}
    .instr-bottom-text{max-height:80px;overflow-y:auto}
    .instr-actions-row{display:flex;align-items:center;gap:12px}
    .instr-countdown-bar{flex:1;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden}
    #instr-countdown-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent-cyan,#0f6cff),var(--accent-purple,#7b5bff));transition:width 0.4s linear}

    /* RESPONSIVE */
    @media(max-width:768px){
    .instructions-body{flex-direction:column}
    .instr-left{border-right:none;border-bottom:4px solid #fff}
    .instr-right{width:100%;min-width:0;height:200px}
    .instr-game-title{font-size:clamp(24px,6vw,48px)}
}
    </style>
</head>
<body>
    <!-- Audio de Fondo (Solo para Title Screen) -->
    <audio id="bg-music" loop>
        <source src="mainmenu.mp3" type="audio/mpeg">
    </audio>

    <!-- Pantalla de Carga -->
    <div class="screen-container active clickable-screen" id="loader-screen" role="status" aria-live="polite" tabindex="0" aria-label="Saltar carga">
        
        <div class="new-loader-content">
            <div class="new-loader-text">
                <div class="new-loader-title">CARGANDO</div>
                <div class="new-loader-subtitle" id="loading-status">Preparando recursos del sistema...</div>
            </div>
            <div class="new-loader-percent" id="loading-percent">0%</div>
        </div>

        <div class="new-loader-bar-container">
            <div class="new-loader-bar" id="loading-light"></div>
        </div>

    </div>

    <!-- Pantalla previa al Título (advertencia 20s) -->
    <div class="screen-container hidden clickable-screen" id="pretitle-screen" tabindex="0" aria-label="Informacion previa al inicio (clic para saltar)">
    
    <div class="warning-fullscreen-content">
        <div class="warning-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        </div>
        
        <h2 class="warning-title">ATENCIÓN</h2>
        
        <p class="warning-text">Esta pagina contiene juegos que pueden hablar de temas de suicidio, autolesiones, bullying, acoso escolar y otros temas delicados. Favor de no jugar dichos juegos si no estás seguro de lo que estás haciendo.</p>
        
        <div class="warning-skip">Haz clic o pulsa Enter/Esc para saltar</div>
    </div>
    
    <div class="warning-bottom-bar">
        <div class="warning-timer-text"><span class="pretitle-timer">20s</span></div>
        <div class="warning-progress-container">
        <div class="warning-progress-fill" id="pretitle-fill"></div>
        </div>
    </div>
    
    </div>

    <!-- Pantalla de Título (Inicialmente oculta) -->
    <div class="screen-container hidden clickable-screen" id="title-screen" tabindex="0" aria-label="Iniciar Astral (clic para empezar)">
        
        <!-- Logo y nombre arriba a la izquierda -->
        <div class="title-header-left">
            <img src="logo.png" alt="Astral Logo" id="title-logo" class="title-logo-redesign">
            <div class="title-brand-name">Astral</div>
        </div>
        
        <!-- Contenido central vacío para empujar el press-start hacia abajo -->
        <div class="title-spacer"></div>
        
        <!-- Texto de presionar enter en la parte inferior -->
        <div class="title-bottom-area" id="title-start" tabindex="-1" role="button" aria-hidden="true">
            <p id="press-start" class="press-start-redesign" role="status" aria-live="polite">
                <span class="press-text">PRESIONA <span class="key-hint">ENTER</span> O PRESIONA AQUI CON TU CURSOR O TACTIL PARA COMENZAR</span>
            </p>
        </div>
        
    </div>

    <!-- Setup Screen OOBE -->
    <div id="setup-screen" class="hidden">
        <div class="setup-container">
            <!-- Added Setup Tabs for Login/Register toggle -->
            <div class="setup-tabs">
                <button class="tab-btn active" data-tab="register">CREAR CUENTA</button>
                <button class="tab-btn" data-tab="login">YA TENGO CUENTA</button>
            </div>

            <div class="setup-header">
                <h2 id="setup-title">CONFIGURACIÓN INICIAL</h2>
                <p id="setup-subtitle">Crea tu identidad en Astral</p>
            </div>
            
            <!-- Added Login Form (Hidden by default) -->
            <form id="login-form" class="hidden">
                <div class="setup-grid single-col">
                    <div class="input-group">
                        <label>ID de Usuario</label>
                        <input type="text" id="login-id" placeholder="xX_Player_Xx" required>
                    </div>
                    <div class="input-group">
                        <label>Contraseña</label>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                    </div>
                </div>
                <div class="form-actions">
                    <div id="login-error" class="error-msg"></div>
                    <button type="submit" class="cyber-button">
                        <span class="btn-text">INICIAR SESIÓN</span>
                        <span class="btn-glitch"></span>
                    </button>
                </div>
            </form>

            <form id="setup-form">
                <div class="setup-grid">
                    <!-- Columna Izquierda: Identidad -->
                    <div class="setup-column">
                        <h3>Identidad</h3>
                        <div class="input-group">
                            <label>ID de Usuario (Único)</label>
                            <input type="text" id="setup-id" placeholder="xX_Player_Xx" required pattern="[a-zA-Z0-9_-]+" title="Solo letras, números, guiones y guiones bajos">
                        </div>
                        <div class="input-group">
                            <label>Nombre de Usuario</label>
                            <input type="text" id="setup-name" placeholder="Tu nombre visible" required>
                        </div>
                        <div class="input-group">
                            <label>Apellido</label>
                            <input type="text" id="setup-surname" placeholder="Tu apellido">
                        </div>
                        <div class="input-group">
                            <label>Contraseña</label>
                            <input type="password" id="setup-password" placeholder="••••••••" required minlength="6">
                        </div>
                    </div>

                    <!-- Columna Derecha: Detalles -->
                    <div class="setup-column">
                        <h3>Perfil</h3>
                        <div class="input-group">
                            <label>Edad</label>
                            <input type="number" id="setup-age" placeholder="18" min="13" max="99">
                        </div>
                        <div class="input-group">
                            <label>Sexo</label>
                            <select id="setup-gender">
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                            </select>
                        </div>
                        <div class="input-group full-width">
                            <label>Biografía</label>
                            <textarea id="setup-bio" placeholder="Cuéntanos sobre ti..." rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Avatar Section -->
                <div class="avatar-section">
                    <h3>Avatar</h3>
                    <div class="avatar-preview-container">
                        <img id="avatar-preview" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzQxNjllMSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0yMCAyMXYtMmEtNCA0IDAgMCAwLTQtNEg4YS00IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg==" alt="Avatar Preview">
                        <div class="avatar-inputs">
                            <input type="text" id="setup-avatar-url" placeholder="URL de la imagen (https://...)">
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <div id="setup-error" class="error-msg"></div>
                    <button type="submit" class="cyber-button">
                        <span class="btn-text">INICIAR SISTEMA</span>
                        <span class="btn-glitch"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contenido Principal (Inicialmente oculto) -->

    <div class="screen-container hidden" id="app-screen">
        <!-- Audio para el menú principal (después del OOBE/título) -->
        <audio id="title-music" loop>
            <source src="menuafteroobe.mp3" type="audio/mpeg">
        </audio>
        <!-- Added Floating Header with requested layout -->
        <header id="header" class="app-header">
            <div class="header-left">
                <div class="user-profile-mini">
                    <img id="header-avatar" src="data:image/svg+xml;base64,PHN2Zy..." alt="User">
                <span id="header-username">Player</span>
                </div>
                <div class="header-coins" id="header-coins-container">
                    <svg class="coin-icon" viewBox="0 0 24 24">
                        <!-- Sombra exterior -->
                        <circle cx="12" cy="13" r="9" fill="rgba(0,0,0,0.3)"/>
                        <!-- Base de la moneda -->
                        <circle cx="12" cy="12" r="9" fill="url(#coinGradient)"/>
                        <!-- Borde interior -->
                        <circle cx="12" cy="12" r="7.5" fill="none" stroke="rgba(255,220,100,0.4)" stroke-width="0.8"/>
                        <!-- Estrella central -->
                        <polygon points="12,6 13.5,10 18,10.5 14.5,13.5 15.5,18 12,15.5 8.5,18 9.5,13.5 6,10.5 10.5,10" fill="rgba(255,255,220,0.95)"/>
                        <!-- Brillo superior -->
                        <ellipse cx="9" cy="9" rx="3" ry="2" fill="rgba(255,255,255,0.25)"/>
                        <!-- Definición del gradiente -->
                        <defs>
                            <linearGradient id="coinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#FFE066"/>
                                <stop offset="50%" stop-color="#FFD700"/>
                                <stop offset="100%" stop-color="#CC9900"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <span id="header-coins-count">0</span>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="btn-friends" title="Amigos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        <span class="btn-label">Amigos</span>
                        <span id="friend-requests-indicator" class="friend-requests-indicator" style="display:none;"></span>
                    </button>
                    <button class="header-btn" id="btn-ads" title="Anuncios">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                        <span class="btn-label">Anuncios</span>
                    </button>
                    <button class="header-btn" id="btn-bugs" title="Reportar Bugs">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        <span class="btn-label">Reportar</span>
                    </button>
                    <button class="header-btn" id="btn-settings" title="Configuración">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"></path><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33"></path></svg>
                        <span class="btn-label">Ajustes</span>
                    </button>
                </div>
            </div>
            <div class="header-right">
                <span class="header-title">Astral</span>
            </div>
        </header>
        <div class="content">
            <div style="display: flex; width: 100%; height: 100%; align-items: flex-start;">
                <div class="main-content" id="main-content">
                    <!-- Sección Inicio mejorada -->
                    <div id="section-home" class="content-section active">
                        <div class="home-hero">
                            <div class="hero-content">
                                <h1 class="home-title-highlight">Bienvenido a Astral</h1>
                                <p class="home-desc">Explora el universo de los juegos web. Astral es una web pensada para dispositivos de gama baja con una interfaz limpia y rápida. Usa la flecha azul para abrir menús y navegar.</p>
                                <div class="hero-cta-row">
                                </div>
                            </div>

                            <div class="home-info-grid" role="list">
                                <div class="home-info-card" role="listitem">
                                    <h3>Bienvenido de vuelta</h3>
                                    <p>Tu portal de juegos, mejorado y con más posibilidades.</p>
                                </div>
                                <div class="home-info-card" role="listitem">
                                    <h3>+100 Juegos</h3>
                                    <p>Clásicos retro y novedades modernas, todos en un solo lugar.</p>
                                </div>
                                <div class="home-info-card" role="listitem">
                                    <h3>Comunidad</h3>
                                    <p>Comparte y compite con otros players — integración social ligera.</p>
                                </div>
                                <div class="home-info-card" role="listitem">
                                    <h3>Personalización</h3>
                                    <p>Perfil, logros y ajustes para adaptar la experiencia a ti.</p>
                                </div>
                            </div>

                            <div class="home-footer-info">
                                <span>Versión 1.0 - Build P-1.0</span>
                            </div>
                        </div>
                    </div>
                    <!-- Sección de juegos: duplicada desde Inicio y preparada para mostrar tarjetas anchas -->
                        <div id="section-games" class="content-section">
                            <div class="games-fullpage-container" style="width:100%;max-width:1200px;padding:0 18px;">
                                <div class="games-header-bar">
                                    <div class="games-search-bar" style="margin-top:12px;display:flex;justify-content:center;">
                                        <input id="games-search" type="text" placeholder="Buscar juegos por nombre..." style="width:60%;max-width:640px;padding:10px 14px;border-radius:10px;border:1px solid #2a2a3a;background:rgba(0,0,0,0.35);color:#fff;">
                                    </div>
                                </div>
                                <div id="games-grid" class="games-grid" style="margin-top:20px;">
                                    <!-- Las tarjetas de juegos serán inyectadas por script.js -->
                                </div>
                                <div id="games-empty" class="games-empty" style="display:none;">No se encontraron juegos.</div>
                            </div>
                        </div>
                    </div>
                    <!-- Sección comunidad funcional -->
                    <div id="section-community" class="content-section">
                        <div class="community-header-bar">
                            <span class="community-title">Comunidad Astral</span>
                            <span class="community-desc">Conoce y conecta con otros jugadores</span>
                        </div>
                        <div class="community-users-list"></div>
                        <div class="community-loading" style="display:none;">Cargando usuarios...</div>
                        <div class="community-empty" style="display:none;">No hay usuarios registrados.</div>
                        <div class="community-error" style="display:none;">Error al cargar la comunidad.</div>
                    </div>
                    <!-- Sección Perfil: editar tu perfil (accesible desde drawer) -->
                    <div id="section-profile" class="content-section" style="padding:28px;">
                        <div style="max-width:820px;margin:0 auto;background:linear-gradient(165deg,rgba(18,19,26,0.95),rgba(15,23,36,0.98));padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);">
                            <h2 style="margin:0 0 12px;font-size:1.6rem;">Editar Perfil</h2>
                            <p style="margin:0 0 18px;color:rgba(200,220,255,0.7);">Aquí puedes actualizar tu nombre, avatar, bio y otros detalles de tu cuenta.</p>

                            <form id="profile-form">
                                <div style="display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start;">
                                    <div>
                                        <div class="input-group">
                                            <label>ID de usuario (no editable)</label>
                                            <input type="text" id="profile-id" disabled>
                                        </div>
                                        <div class="input-group">
                                            <label>Nombre visible</label>
                                            <input type="text" id="profile-name">
                                        </div>
                                        <div class="input-group">
                                            <label>Apellido</label>
                                            <input type="text" id="profile-surname">
                                        </div>
                                        <div class="input-group">
                                            <label>Edad</label>
                                            <input type="number" id="profile-age" min="13" max="120">
                                        </div>
                                        <div class="input-group">
                                            <label>Sexo</label>
                                            <select id="profile-gender">
                                                <option value="male">Masculino</option>
                                                <option value="female">Femenino</option>
                                            </select>
                                        </div>
                                        <div class="input-group full-width">
                                            <label>Biografía</label>
                                            <textarea id="profile-bio" rows="4"></textarea>
                                        </div>
                                    </div>

                                    <div style="display:flex;flex-direction:column;gap:10px;align-items:center;">
                                        <div style="width:200px;text-align:center;">
                                            <img id="avatar-preview-profile" src="logo.png" alt="Avatar" style="width:140px;height:140px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,0.06);background:#111;">
                                        </div>
                                        <div style="width:100%;">
                                            <label>URL de avatar</label>
                                            <input type="text" id="profile-avatar-url" placeholder="https://...">
                                        </div>
                                    </div>
                                </div>

                                <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:18px;">
                                    <div id="profile-msg" style="align-self:center;color:rgba(200,220,255,0.8);"></div>
                                    <button id="profile-save-btn" class="background-button" type="button">Guardar cambios</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Sección Admin: solo visible para roles owner/admin/admin_senior -->
                    <div id="section-admin" class="content-section" style="padding:28px;">
                        <div style="max-width:1100px;margin:0 auto;background:linear-gradient(165deg,rgba(18,19,26,0.95),rgba(15,23,36,0.98));padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);">
                            <h2 style="margin:0 0 12px;font-size:1.6rem;">Panel de Administración</h2>
                            <p style="margin:0 0 18px;color:rgba(200,220,255,0.7);">Acceso restringido: solo owner, admin_senior o admin. Aquí puedes ver y editar todos los registros de la tabla <code>usuarios</code>.</p>
                            
                            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
                            <input id="admin-search" placeholder="Buscar por id o nombre..." style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff">
                            <button id="admin-refresh-btn" class="background-button">Refrescar</button>
                            </div>
                            
                            <div id="admin-loading" style="display:none;margin:8px 0;color:var(--accent-cyan);">Cargando usuarios...</div>
                            <div id="admin-error" style="display:none;margin:8px 0;color:#ff8a8a;">Error al cargar usuarios.</div>
                            <div id="admin-empty" style="display:none;margin:8px 0;color:rgba(200,220,255,0.7);">No hay usuarios registrados.</div>
                            
                            <div id="admin-users-list" class="admin-users-list" style="display:flex;flex-direction:column;gap:12px;margin-top:12px;max-height:60vh;overflow:auto"></div>
                        </div>
                    </div>

                    <!-- Modales para perfil y solicitud de amistad -->
                    <div id="userProfileModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:99999;align-items:center;justify-content:center;">
                        <div style="background:var(--card-bg,#181c2f);border-radius:18px;padding:2rem;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;position:relative;border:2px solid var(--accent-color,#4169e1);">
                            <button onclick="closeUserProfileModal()" style="position:absolute;top:15px;right:15px;background:none;border:none;color:#fff;font-size:1.5em;cursor:pointer;line-height:1;">&times;</button>
                            <div id="userProfileModalContent"></div>
                        </div>
                    </div>
                    <!-- Sección Configuración (in-page) -->
                    <div id="section-settings" class="content-section" aria-hidden="true">
                        <div style="width:92%;max-width:760px;margin:0 auto;">
                            <div class="settings-card" role="region" aria-label="Configuración">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                    <h2 style="margin:0">Configuración</h2>
                                </div>
                                <div class="settings-grid">
                                    <!-- Tema option removed -->
                                    <div class="settings-row">
                                        <h3>Color de acento</h3>
                                        <input id="settings-accent" type="color" value="#4169e1">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Tamaño de fuente</h3>
                                        <input id="settings-font-size" type="range" min="12" max="20" value="16">
                                        <div id="settings-font-size-value" style="font-size:0.9rem;color:rgba(200,220,255,0.8);">16px</div>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Avatar visible</h3>
                                        <label style="display:flex;align-items:center;gap:8px"><input id="settings-show-avatars" type="checkbox" checked> Mostrar avatares</label>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Color del header</h3>
                                        <input id="settings-header-color" type="color" value="#0f1724">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Color barra inferior</h3>
                                        <input id="settings-footer-color" type="color" value="#0b0d12">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Fullscreen Iframe</h3>
                                        <select id="settings-iframe-fs"><option value="iframe">Iframe</option><option value="overlay">Overlay</option></select>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Reducir animaciones</h3>
                                        <label style="display:flex;align-items:center;gap:8px"><input id="settings-reduced-motion" type="checkbox"> Reducir</label>
                                    </div>
                                </div>
                                <div class="settings-actions">
                                    <button id="settings-reset" class="background-button">Restablecer</button>
                                    <button id="settings-close" class="background-button">Cerrar</button>
                                    <button id="settings-apply" class="background-button">Aplicar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Settings Section previously duplicated; removed from here (moved into #main-content) -->
    <!-- Footer (styled by settings) -->
    <footer id="footer-drawer" class="footer-drawer bottom-nav" style="position:fixed;left:0;right:0;bottom:0;height:56px;display:flex;align-items:center;justify-content:center;background:#0b0d12;color:#e7f7ff;z-index:9999;border-top:1px solid rgba(255,255,255,0.03);">
        <div style="width:100%;max-width:1200px;padding:0 14px;display:flex;align-items:center;justify-content:space-between;">
            <div style="font-size:0.95rem;opacity:0.9;">© Astral</div>
            <div style="display:flex;gap:8px;align-items:center;opacity:0.9;">
                <button class="background-button drawer-item" data-section="ayuda" style="padding:8px 10px;font-size:0.9rem;">Ayuda</button>
                <button class="background-button" style="padding:8px 10px;font-size:0.9rem;">Soporte</button>
                <!-- Admin button: hidden by default, shown only for owner/admin/admin_senior -->
                <button id="footer-admin-btn" class="background-button drawer-item" data-section="admin" style="display:none;padding:8px 10px;font-size:0.9rem;">Admin</button>
            </div>
        </div>
    </footer>

    <!-- Friends Panel (modal) -->
    <div id="friendsPanel" style="display:none;position:fixed;z-index:99999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;">
        <div class="friends-panel-modal">
            <button onclick="document.getElementById('friendsPanel').style.display='none'" class="friends-panel-close">&times;</button>
            <h2 class="friends-panel-title">Amigos</h2>
            <div class="friends-panel-content">
                <div class="friends-panel-column">
                    <h3>Solicitudes</h3>
                    <ul id="friendRequestsList" class="friends-list"></ul>
                </div>
                <div class="friends-panel-column">
                    <h3>Lista de Amigos</h3>
                    <ul id="friendList" class="friends-list"></ul>
                </div>
            </div>
            <div class="friends-panel-add">
                <input id="addFriendInput" placeholder="ID de usuario">
                <textarea id="addFriendMessage" placeholder="Mensaje opcional..." rows="3" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;box-sizing:border-box;"></textarea>
                <button id="addFriendBtn" class="background-button">Enviar solicitud</button>
            </div>
        </div>
    </div>
    <!-- Messages Panel (modal) -->
    <div id="messagesPanel" style="display:none;position:fixed;z-index:100000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;">
        <div class="chat-container">
            <!-- Mover el botón cerrar a la izquierda para evitar solapado con controles del header -->
            <button onclick="closeMessagesPanel()" class="friends-panel-close chat-close-btn" aria-label="Cerrar chat">&times;</button>
            
            <!-- CONTACTOS A LA IZQUIERDA -->
            <aside class="chat-sidebar">
                <h3 class="chat-sidebar-title">Conversaciones</h3>
                <div id="conversationsList" class="conversations-list"></div>
            </aside>
            
            <!-- CHAT A LA DERECHA -->
            <main class="chat-main-panel">
                <div id="chatHeader" class="chat-header">
                    <!-- Title + conversation warning badge -->
                    <div id="chatHeaderTitle" class="chat-title-wrap">
                      <div id="chatTitleText" class="chat-title-text">Selecciona una conversación</div>
                      <div id="chatWarning" class="chat-conversation-warning" role="note" aria-hidden="true">
                        <svg class="chat-warn-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" fill="#ef4444"/><path d="M12 9v4" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 17h.01" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <span class="chat-warn-text">Los chats se restablecen cada fin de mes</span>
                      </div>
                    </div>
                    <button id="chatReloadBtn" class="background-button chat-reload-btn" title="Recargar conversación" aria-label="Recargar conversación">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 12a9 9 0 10-3.1 6.6L21 12z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
                <div id="chatMessages" class="chat-messages-area"></div>
                <div class="chat-input-container">
                    <input id="chatInput" type="text" placeholder="Escribe un mensaje..." class="chat-input" />
                    <button id="chatSendBtn" class="background-button primary chat-send-btn" title="Enviar mensaje" aria-label="Enviar mensaje">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M22 2L11 13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                      <span class="sr-only">Enviar</span>
                    </button>
                </div>
            </main>
        </div>
    </div>  
        <!-- Overlay para abrir juegos en iframe fullscreen -->
        <div id="game-iframe-overlay" class="hidden" aria-hidden="true">
            <div class="iframe-toggle-arrow" id="iframe-toggle-arrow" title="Abrir menú">
                <span>❯</span>
            </div>
            <div class="iframe-container">
                <iframe id="game-iframe" src="about:blank" allow="fullscreen; autoplay;" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
            </div>
            <aside id="iframe-sidebar" class="iframe-sidebar" aria-hidden="true">
                <button id="iframe-close-sidebar" class="sidebar-close" title="Cerrar">&times;</button>
                <div class="sidebar-content">
                                        <div style="display:flex;flex-direction:column;gap:10px;">
                                            <button id="sidebar-exit-btn" class="background-button primary">Salir del juego</button>
                                            <button id="sidebar-fullscreen-btn" class="background-button">Pantalla completa</button>
                                            <button id="sidebar-exit-fullscreen-btn" class="background-button" style="display:none;background:linear-gradient(45deg,#ff6b6b,#d64545);">Salir pantalla completa</button>
                                        </div>
                </div>
            </aside>
        </div>

        <!-- INSTRUCCIONES: pantalla que aparece antes de entrar al juego -->
        <div id="game-instructions-modal" class="game-instructions hidden" aria-hidden="true">
        <audio id="instructions-audio" loop preload="auto">
            <source src="instrucciones.mp3" type="audio/mpeg">
        </audio>
        <div class="instructions-card" role="dialog" aria-modal="true" aria-label="Instrucciones del juego">
            
            <!-- HEADER: Logo + Timer + Título -->
            <div class="instructions-top">
            <img id="instr-logo" class="instr-logo" src="logo.png" alt="logo">
            <div class="instr-title-wrap">
                <div id="instr-timer" class="instr-timer">0s</div>
                <h1 id="instr-game-title" class="instr-game-title">(Nombre del juego)</h1>
            </div>
            </div>

            <!-- CUERPO: Controles (izq) + Video (der) -->
            <div class="instructions-body">
            <div class="instr-left">
                <h2 class="instr-section-title">Controles especiales:</h2>
                <div id="instr-top-text" class="instr-text">{Aqui pongo los controles especificos}</div>
            </div>
            <div class="instr-right">
                <div class="instr-video-wrap">
                <div class="instr-video-container">
                    <img id="instr-video" class="instr-video" alt="Vista previa del juego" style="display:none;">
                    <div id="instr-video-placeholder" class="instr-video-placeholder">Si ves esta pantalla, no hay un video disponible para tu juego.</div>
                    <button id="instr-overlay-play" aria-hidden="true">▶</button>
                </div>
                </div>
            </div>
            </div>

            <!-- FOOTER: Instrucciones de juego + Barra de progreso -->
            <div class="instructions-bottom">
            <div class="instr-bottom-content">
                <h2 class="instr-section-title">Instrucciones:</h2>
                <div id="instr-bottom-text" class="instr-text instr-bottom-text">{Aqui pongo como jugar, asegurate de que dure este campo completo}</div>
            </div>
            <div class="instr-actions-row">
                <button id="instr-skip-btn" class="background-button">Saltar instrucciones</button>
                <div id="instr-countdown-bar" class="instr-countdown-bar">
                <div id="instr-countdown-fill"></div>
                </div>
            </div>
            </div>

        </div>
        </div>

                <!-- Toast breve para confirmaciones (mostrado por script.js) -->
                <div id="astral-toast" class="astral-toast hidden" aria-live="polite"></div>
                <!-- Early ban-check: evita cargar el app JS si el usuario está baneado -->
                <script>
                    (function(){
                        try {
                            const API = 'https://astral-ban-api.onrender.com';
                            const userStr = localStorage.getItem('astralUser');
                            if (!userStr) return; // no hay usuario, continuar carga normal
                            const user = JSON.parse(userStr || '{}');
                            if (!user.id) return;
                            // Hacer fetch asíncrono antes de cargar app.js
                            fetch(`${API}/usuarios/${encodeURIComponent(user.id)}`).then(async (res) => {
                                if (!res.ok) return; // no bloquear si falla
                                const data = await res.json().catch(()=> ({}));
                                if (data && data.baneado) {
                                    const motivo = data.motivo_ban || 'No hay motivo especificado';
                                    const until = data.ban_until ? new Date(data.ban_until).toLocaleString() : 'Indefinido / permanente';
                                    // Simple ban UI (reemplaza body)
                                    document.title = 'Cuenta baneada - Astral';
                                    const banHtml = `\n                    <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#07070b,#0f1220);color:#e7f7ff;padding:24px;">\n                      <div style="max-width:900px;width:100%;background:linear-gradient(180deg,#091019,#06101a);border-radius:12px;padding:22px;border:1px solid rgba(255,255,255,0.04);">\n                        <h1 style="margin:0 0 8px;color:#ff7b7b">Tu cuenta ha sido baneada</h1>\n                        <p style="margin:0 0 12px;">Lo sentimos, tu acceso a Astral ha sido restringido.</p>\n                        <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-top:8px;">\n                          <strong>Motivo:</strong><div style="margin-top:6px;">${String(motivo).replace(/</g,'&lt;')}</div>\n                        </div>\n                        <div style="margin-top:10px;color:rgba(200,220,255,0.75)">\n                          <strong>Vigencia:</strong> ${String(until).replace(/</g,'&lt;')}\n                        </div>\n                        <div style="display:flex;gap:10px;margin-top:16px;">\n                          <button id="__ban_join_discord" style="padding:10px 14px;border-radius:8px;background:#2b6cff;border:none;color:#fff;cursor:pointer">Unirme al Discord</button>\n                          <button id="__ban_retry" style="padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;cursor:pointer">Reintentar verificación</button>\n                        </div>\n                        <div style="margin-top:12px;font-size:0.9rem;color:rgba(200,220,255,0.7);">Si crees que esto es un error, unete al Discord o intenta apelar cuando sea posible.</div>\n                      </div>\n                    </div>\n                  `;
                                    document.body.innerHTML = banHtml;
                                    const j = document.getElementById('__ban_join_discord'); if (j) j.addEventListener('click', ()=> window.open('https://discord.gg/GEPrCZkWhs','_blank'));
                                    const r = document.getElementById('__ban_retry'); if (r) r.addEventListener('click', ()=> location.reload());
                                }
                            }).catch(()=>{});
                        } catch (e) { console.error('early ban check error', e); }
                    })();
                </script>
                <script src="script.js"></script>
                <script src="script-iframe.js"></script>
                <script src="game-instructions-list.js"></script>
                <script src="notices-reporting.js"></script>
                <script src="reports.js"></script>
        <script>
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("/sw.js")
                .then(() => console.log("Service Worker registrado"));
            }
        </script>

</body>
</html>
